# Chat Service - –ú–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

WebSocket —Å–µ—Ä–≤–∏—Å –¥–ª—è —á–∞—Ç–∞ —Å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–µ–π RabbitMQ, Redis –∏ AI-–∞–≥–µ–Ω—Ç–∞.

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

```bash
# 1. –ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–∏—Å–æ–≤
docker-compose up -d chat-service redis rabbitmq

# 2. –û—Ç–∫—Ä—ã—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–π –∫–ª–∏–µ–Ω—Ç
start C:\Users\Crist\Desktop\Hakaton\backend\chat-client-test.html

# 3. –°–º–æ—Ç—Ä–µ—Ç—å –ª–æ–≥–∏ (–≤ –æ—Ç–¥–µ–ª—å–Ω–æ–º —Ç–µ—Ä–º–∏–Ω–∞–ª–µ)
docker-compose logs -f chat-service
```

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

| –ß—Ç–æ | –ö–æ–º–∞–Ω–¥–∞/URL |
|-----|-------------|
| **–õ–æ–≥–∏ chat-service** | `docker-compose logs -f chat-service` |
| **Redis** | `docker exec -it redis redis-cli` |
| **RabbitMQ UI** | http://localhost:15672 (guest/guest) |
| **–ü—Ä–æ—Å–º–æ—Ç—Ä —Å–æ–æ–±—â–µ–Ω–∏–π –≤ Redis** | `docker exec -it redis redis-cli` ‚Üí `LRANGE chat:test-chat-123:messages 0 -1` |
| **Sequence —Å—á–µ—Ç—á–∏–∫** | `docker exec -it redis redis-cli` ‚Üí `GET chat:test-chat-123:sequence` |

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê

‚îÇ   –ö–ª–∏–µ–Ω—Ç    ‚îÇ
‚îÇ  (Browser)  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
       ‚îÇ WebSocket
       ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ        Chat Service (NestJS)        ‚îÇ
‚îÇ  - WebSocket Gateway                ‚îÇ
‚îÇ  - Redis –¥–ª—è –∫—ç—à–∞ —Å–æ–æ–±—â–µ–Ω–∏–π         ‚îÇ
‚îÇ  - RabbitMQ –¥–ª—è –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–æ–≤       ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
     ‚îÇ             ‚îÇ
     ‚îÇ             ‚îÇ
     ‚ñº             ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇRabbitMQ ‚îÇ   ‚îÇ    Redis     ‚îÇ
‚îÇ         ‚îÇ   ‚îÇ  (–∫—ç—à N msg) ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
     ‚îÇ
     ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
     ‚îÇ              ‚îÇ
     ‚ñº              ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ –ë–î       ‚îÇ   ‚îÇ AI       ‚îÇ
‚îÇ –°–µ—Ä–≤–∏—Å   ‚îÇ   ‚îÇ –°–µ—Ä–≤–∏—Å   ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                    ‚îÇ
                    ‚îÇ (–æ—Ç–≤–µ—Ç)
                    ‚ñº
              [Chat Service]
```

## –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å

### 1. –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

–ö–æ–≥–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ —á–µ—Ä–µ–∑ WebSocket:

1. **WebSocket Gateway** –ø–æ–ª—É—á–∞–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ
2. **–û—Ç–ø—Ä–∞–≤–∫–∞ –≤—Å–µ–º —É—á–∞—Å—Ç–Ω–∏–∫–∞–º —á–∞—Ç–∞** —á–µ—Ä–µ–∑ WebSocket
3. **–ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ Redis** - —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –ø–æ—Å–ª–µ–¥–Ω–∏–µ N —Å–æ–æ–±—â–µ–Ω–∏–π
4. **–û—Ç–ø—Ä–∞–≤–∫–∞ –≤ –ë–î —Å–µ—Ä–≤–∏—Å** (RabbitMQ `db_messages`) - –æ–¥–Ω–æ —Å–æ–æ–±—â–µ–Ω–∏–µ
5. **–û—Ç–ø—Ä–∞–≤–∫–∞ –≤ AI —Å–µ—Ä–≤–∏—Å** (RabbitMQ `ai_requests`) —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏:
   - `chatId` - ID —á–∞—Ç–∞
   - `message` - —Ç–µ–∫—É—â–µ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
   - `messageHistory` - –ø–æ—Å–ª–µ–¥–Ω–∏–µ N —Å–æ–æ–±—â–µ–Ω–∏–π –∏–∑ Redis
   - `aiId` - ID –º–æ–¥–µ–ª–∏ AI (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

### 2. –ü–æ–ª—É—á–µ–Ω–∏–µ –æ—Ç–≤–µ—Ç–∞ –æ—Ç AI

AI-—Å–µ—Ä–≤–∏—Å –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∑–∞–ø—Ä–æ—Å –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –æ—Ç–≤–µ—Ç –≤ `ai_responses`:

1. **Chat Service** –ø–æ–ª—É—á–∞–µ—Ç –æ—Ç–≤–µ—Ç –æ—Ç AI
2. **–ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Ç–≤–µ—Ç–∞ AI –≤ Redis**
3. **–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –æ—Ç–≤–µ—Ç–∞ –≤ –ë–î** —á–µ—Ä–µ–∑ RabbitMQ
4. **–û—Ç–ø—Ä–∞–≤–∫–∞ –æ—Ç–≤–µ—Ç–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º** —á–µ—Ä–µ–∑ WebSocket

## –û—á–µ—Ä–µ–¥–∏ RabbitMQ

### `db_messages`
**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∫–∞–∂–¥–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è –≤ –ë–î

**–§–æ—Ä–º–∞—Ç**:
```json
{
  "messageId": "chat123-1705315800000-abc123xyz",
  "sequence": 1,
  "username": "–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å",
  "message": "–ü—Ä–∏–≤–µ—Ç!",
  "timestamp": "2025-01-15T10:30:00Z",
  "chatId": "chat123"
}
```

### `ai_requests`
**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –ó–∞–ø—Ä–æ—Å—ã –∫ AI-—Å–µ—Ä–≤–∏—Å—É—è

**–§–æ—Ä–º–∞—Ç**:
```json
{
  "chatId": "chat123",
  "message": "–ö–∞–∫ –¥–µ–ª–∞?",
  "messageHistory": [
    {
      "messageId": "chat123-1705315800000-abc123xyz",
      "sequence": 1,
      "username": "–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å",
      "message": "–ü—Ä–∏–≤–µ—Ç!",
      "timestamp": "2025-01-15T10:30:00Z",
      "chatId": "chat123"
    }
  ],
  "aiId": "gpt-4"
}
```

### `ai_responses`
**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –û—Ç–≤–µ—Ç—ã –æ—Ç AI-—Å–µ—Ä–≤–∏—Å–∞

**–§–æ—Ä–º–∞—Ç**:
```json
{
  "chatId": "chat123",
  "response": "–ü—Ä–∏–≤–µ—Ç! –£ –º–µ–Ω—è –≤—Å—ë –æ—Ç–ª–∏—á–Ω–æ, —Å–ø–∞—Å–∏–±–æ!"
}
```

## Redis –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ

–î–ª—è –∫–∞–∂–¥–æ–≥–æ —á–∞—Ç–∞ —Ö—Ä–∞–Ω–∏—Ç—Å—è —Å–ø–∏—Å–æ–∫ –ø–æ—Å–ª–µ–¥–Ω–∏—Ö N —Å–æ–æ–±—â–µ–Ω–∏–π:

- **–ö–ª—é—á —Å–æ–æ–±—â–µ–Ω–∏–π**: `chat:{chatId}:messages`
- **–¢–∏–ø**: Redis List
- **TTL**: 24 —á–∞—Å–∞
- **–ú–∞–∫—Å–∏–º—É–º**: –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ `REDIS_MAX_MESSAGES` (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 50)

### Sequence (–ø–æ—Ä—è–¥–∫–æ–≤—ã–π –Ω–æ–º–µ—Ä)

–î–ª—è –≥–∞—Ä–∞–Ω—Ç–∏–∏ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ –ø–æ—Ä—è–¥–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∞—Ç–æ–º–∞—Ä–Ω—ã–π —Å—á–µ—Ç—á–∏–∫:

- **–ö–ª—é—á**: `chat:{chatId}:sequence`
- **–¢–∏–ø**: Redis Counter (INCR)
- **TTL**: 7 –¥–Ω–µ–π
- **–ó–Ω–∞—á–µ–Ω–∏—è**: 1, 2, 3, 4... (–∏–Ω–∫—Ä–µ–º–µ–Ω—Ç–∏—Ä—É—é—Ç—Å—è –∞—Ç–æ–º–∞—Ä–Ω–æ)

–≠—Ç–æ —Ä–µ—à–∞–µ—Ç –ø—Ä–æ–±–ª–µ–º—É race condition, –∫–æ–≥–¥–∞:
- –°–æ–æ–±—â–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –≤ –ë–î
- –û—Ç–≤–µ—Ç AI –ø—Ä–∏—Ö–æ–¥–∏—Ç —Ä–∞–Ω—å—à–µ
- –ë–î –º–æ–∂–µ—Ç –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø–æ—Ä—è–¥–æ–∫ –ø–æ `sequence`

## –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

```env
PORT=3001
RABBITMQ_URL=amqp://guest:guest@rabbitmq:5672
REDIS_URL=redis://redis:6379
REDIS_MAX_MESSAGES=50
```

## –ó–∞–ø—É—Å–∫ –∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### 1. –ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–∏—Å–æ–≤

```bash
# –ó–∞–ø—É—Å–∫ –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
docker-compose up -d chat-service redis rabbitmq

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞
docker-compose ps
```

### 2. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —á–µ—Ä–µ–∑ –≤–µ–±-–∫–ª–∏–µ–Ω—Ç

–û—Ç–∫—Ä–æ–π—Ç–µ —Ñ–∞–π–ª `chat-client-test.html` –≤ –±—Ä–∞—É–∑–µ—Ä–µ:

```bash
# Windows
start C:\Users\Crist\Desktop\Hakaton\backend\chat-client-test.html

# Linux/Mac
open /path/to/chat-client-test.html
```

**–ß—Ç–æ –º–æ–∂–Ω–æ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å:**
- ‚úÖ –ê–Ω–æ–Ω–∏–º–Ω—ã–π —á–∞—Ç (–±–µ–∑ username)
- ‚úÖ –ú–µ–Ω–µ–¥–∂–µ—Ä —Å –∏–º–µ–Ω–µ–º (—É–∫–∞–∑–∞—Ç—å username)
- ‚úÖ –†–∞–∑–Ω—ã–µ AI –º–æ–¥–µ–ª–∏ (—É–∫–∞–∑–∞—Ç—å aiId)
- ‚úÖ Sequence –∏ messageId –≤ –∫–∞–∂–¥–æ–º —Å–æ–æ–±—â–µ–Ω–∏–∏

### 3. –õ–æ–∫–∞–ª—å–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞

```bash
cd chat-service
npm install
npm run start:dev
```

## API WebSocket

### –°–æ–±—ã—Ç–∏—è –æ—Ç –∫–ª–∏–µ–Ω—Ç–∞ –∫ —Å–µ—Ä–≤–µ—Ä—É

**join** - –ü—Ä–∏—Å–æ–µ–¥–∏–Ω–∏—Ç—å—Å—è –∫ —á–∞—Ç—É
```javascript
// –û–±—ã—á–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å (–∞–Ω–æ–Ω–∏–º–Ω—ã–π)
socket.emit('join', {
  chatId: 'chat123'
});

// –ú–µ–Ω–µ–¥–∂–µ—Ä –∏–ª–∏ AI —Å –∏–º–µ–Ω–µ–º
socket.emit('join', {
  username: '–ú–µ–Ω–µ–¥–∂–µ—Ä –ò–≤–∞–Ω',
  chatId: 'chat123'
});
```

**message** - –û—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ
```javascript
socket.emit('message', {
  message: '–ü—Ä–∏–≤–µ—Ç!',
  aiId: 'gpt-4' // –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ
});
```

### –°–æ–±—ã—Ç–∏—è –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞ –∫ –∫–ª–∏–µ–Ω—Ç—É

**message** - –ù–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ —á–∞—Ç–µ
```javascript
socket.on('message', (data) => {
  // { messageId, sequence, username, message, timestamp, chatId }
  // messageId: —É–Ω–∏–∫–∞–ª—å–Ω—ã–π ID —Å–æ–æ–±—â–µ–Ω–∏—è
  // sequence: –ø–æ—Ä—è–¥–∫–æ–≤—ã–π –Ω–æ–º–µ—Ä –≤ —á–∞—Ç–µ (1, 2, 3...)
  // username: "–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å" (–∞–Ω–æ–Ω–∏–º—ã), "AI –ê—Å—Å–∏—Å—Ç–µ–Ω—Ç", "–ú–µ–Ω–µ–¥–∂–µ—Ä –ò–≤–∞–Ω" –∏ —Ç.–¥.
});
```

## –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –æ—Ç–ª–∞–¥–∫–∞

### –õ–æ–≥–∏ Chat Service

–î–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –ø–æ–¥—Ä–æ–±–Ω—ã—Ö –ª–æ–≥–æ–≤ —Ä–∞–±–æ—Ç—ã —Å–µ—Ä–≤–∏—Å–∞:

```bash
docker-compose logs -f chat-service
```

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ª–æ–≥–æ–≤

#### 1. –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –ë–î

```
üì¶ ‚ïê‚ïê‚ïê –û–¢–ü–†–ê–í–ö–ê –í –ë–î –°–ï–†–í–ò–° ‚ïê‚ïê‚ïê
–û—á–µ—Ä–µ–¥—å: db_messages
–î–∞–Ω–Ω—ã–µ: {
  "messageId": "chat123-1705315800000-abc123xyz",
  "sequence": 1,
  "username": "–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å",
  "message": "–ü—Ä–∏–≤–µ—Ç!",
  "timestamp": "2025-01-15T10:30:00.000Z",
  "chatId": "chat123"
}
‚úÖ –°–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –≤ –ë–î
```

#### 2. –û—Ç–ø—Ä–∞–≤–∫–∞ –∑–∞–ø—Ä–æ—Å–∞ –≤ AI —Å–µ—Ä–≤–∏—Å

```
ü§ñ ‚ïê‚ïê‚ïê –û–¢–ü–†–ê–í–ö–ê –í AI –°–ï–†–í–ò–° ‚ïê‚ïê‚ïê
–û—á–µ—Ä–µ–¥—å: ai_requests
Chat ID: chat123
–¢–µ–∫—É—â–µ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ: –ü—Ä–∏–≤–µ—Ç!
–ò—Å—Ç–æ—Ä–∏—è —Å–æ–æ–±—â–µ–Ω–∏–π: 5 —à—Ç.
AI Model ID: gpt-4
–ü–æ–ª–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ: {
  "chatId": "chat123",
  "message": "–ü—Ä–∏–≤–µ—Ç!",
  "messageHistory": [...],
  "aiId": "gpt-4"
}
‚úÖ –ó–∞–ø—Ä–æ—Å –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω –≤ AI —Å–µ—Ä–≤–∏—Å
```

#### 3. –ü–æ–ª—É—á–µ–Ω–∏–µ –æ—Ç–≤–µ—Ç–∞ –æ—Ç AI

```
üéØ ‚ïê‚ïê‚ïê –ü–û–õ–£–ß–ï–ù –û–¢–í–ï–¢ –û–¢ AI –°–ï–†–í–ò–°–ê ‚ïê‚ïê‚ïê
–û—á–µ—Ä–µ–¥—å: ai_responses
Chat ID: chat123
–û—Ç–≤–µ—Ç AI: –ü—Ä–∏–≤–µ—Ç! –ß–µ–º –º–æ–≥—É –ø–æ–º–æ—á—å?
–ü–æ–ª–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ: {
  "chatId": "chat123",
  "response": "–ü—Ä–∏–≤–µ—Ç! –ß–µ–º –º–æ–≥—É –ø–æ–º–æ—á—å?"
}

üìù –°—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ AI:
  Message ID: chat123-1705315802000-xyz789
  Sequence: 2
  Username: AI –ê—Å—Å–∏—Å—Ç–µ–Ω—Ç
‚úÖ –û—Ç–≤–µ—Ç AI –∑–∞–∫—ç—à–∏—Ä–æ–≤–∞–Ω –≤ Redis

üì¶ ‚ïê‚ïê‚ïê –û–¢–ü–†–ê–í–ö–ê –û–¢–í–ï–¢–ê AI –í –ë–î ‚ïê‚ïê‚ïê
–û—á–µ—Ä–µ–¥—å: db_messages
–î–∞–Ω–Ω—ã–µ: {...}
‚úÖ –û—Ç–≤–µ—Ç AI –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω –≤ –ë–î

üåê –û—Ç–ø—Ä–∞–≤–∫–∞ –æ—Ç–≤–µ—Ç–∞ AI —á–µ—Ä–µ–∑ WebSocket
  –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–¥–∫–ª—é—á–µ–Ω–Ω—ã—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤: 1
‚úÖ –û—Ç–≤–µ—Ç AI –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω –≤—Å–µ–º —É—á–∞—Å—Ç–Ω–∏–∫–∞–º —á–∞—Ç–∞
```

### RabbitMQ Management UI

–ü—Ä–æ—Å–º–æ—Ç—Ä –æ—á–µ—Ä–µ–¥–µ–π –∏ —Å–æ–æ–±—â–µ–Ω–∏–π: http://localhost:15672

**–õ–æ–≥–∏–Ω**: guest
**–ü–∞—Ä–æ–ª—å**: guest

**–û—á–µ—Ä–µ–¥–∏ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏:**
- `db_messages` - —Å–æ–æ–±—â–µ–Ω–∏—è –¥–ª—è –ë–î
- `ai_requests` - –∑–∞–ø—Ä–æ—Å—ã –∫ AI
- `ai_responses` - –æ—Ç–≤–µ—Ç—ã –æ—Ç AI

### Redis CLI

–ü—Ä–æ–≤–µ—Ä–∫–∞ –∫—ç—à–∞ –∏ —Å—á–µ—Ç—á–∏–∫–æ–≤:

```bash
# –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ Redis
docker exec -it redis redis-cli

# –ü—Ä–æ—Å–º–æ—Ç—Ä —Å–æ–æ–±—â–µ–Ω–∏–π —á–∞—Ç–∞
LRANGE chat:chat123:messages 0 -1

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–µ–∫—É—â–µ–≥–æ sequence
GET chat:chat123:sequence

# –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–æ–æ–±—â–µ–Ω–∏–π –≤ –∫—ç—à–µ
LLEN chat:chat123:messages
```

## –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –¥—Ä—É–≥–∏–º–∏ —Å–µ—Ä–≤–∏—Å–∞–º–∏

### –ë–î –°–µ—Ä–≤–∏—Å
–ü–æ–¥–ø–∏—Å–∞—Ç—å—Å—è –Ω–∞ `db_messages` –∏ —Å–æ—Ö—Ä–∞–Ω—è—Ç—å –∫–∞–∂–¥–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ.

### AI –°–µ—Ä–≤–∏—Å
1. –ü–æ–¥–ø–∏—Å–∞—Ç—å—Å—è –Ω–∞ `ai_requests`
2. –û–±—Ä–∞–±–æ—Ç–∞—Ç—å —Å —É—á–µ—Ç–æ–º `messageHistory` –∏ `aiId`
3. –û—Ç–ø—Ä–∞–≤–∏—Ç—å –æ—Ç–≤–µ—Ç –≤ `ai_responses` —Å `chatId` –∏ `response`
